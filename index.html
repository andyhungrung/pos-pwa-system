<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>POS銷售系統</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f3f4f6; }
        .container { height: 100vh; display: flex; flex-direction: column; }
        .header { background: white; padding: 16px; border-bottom: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .nav { display: flex; justify-content: space-between; align-items: center; }
        .title { font-size: 24px; font-weight: bold; color: #1f2937; }
        .nav-buttons { display: flex; gap: 8px; }
        .nav-btn { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; }
        .nav-btn.active { background: #2563eb; color: white; }
        .nav-btn:not(.active) { background: #e5e7eb; color: #374151; }
        .main { flex: 1; overflow: hidden; }
        .page { display: none; height: 100%; }
        .page.active { display: flex; flex-direction: column; }
        .page-content { flex: 1; padding: 16px; overflow-y: auto; }
        .section-title { font-size: 20px; font-weight: 600; margin-bottom: 16px; }
        .card { background: white; padding: 16px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 16px; }
        .input { padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; width: 100%; }
        .button { padding: 12px 16px; background: #2563eb; color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; }
        .button:disabled { opacity: 0.5; cursor: not-allowed; }
        .button-green { background: #16a34a; }
        .button-red { background: #dc2626; }
        .button-gray { background: #6b7280; }
        .sales-layout { flex: 1; display: flex; flex-direction: column; }
        @media (min-width: 769px) { .sales-layout { flex-direction: row; } }
        .products-area { flex: 2; padding: 16px; overflow-y: auto; }
        .cart-area { flex: 1; background: white; border-top: 2px solid #e5e7eb; padding: 16px; display: flex; flex-direction: column; }
        @media (min-width: 769px) { .cart-area { width: 320px; border-top: none; border-left: 1px solid #e5e7eb; } }
        .product-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        @media (min-width: 769px) { .product-grid { grid-template-columns: repeat(3, 1fr); } }
        .product-card { background: white; padding: 16px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: pointer; text-align: center; min-height: 80px; display: flex; flex-direction: column; justify-content: center; }
        .product-card:hover { border: 2px solid #60a5fa; }
        .cart-items { flex: 1; overflow-y: auto; margin-bottom: 12px; }
        .cart-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f3f4f6; }
        .control-btn { width: 28px; height: 28px; background: #e5e7eb; border: none; border-radius: 4px; cursor: pointer; }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        .table th { background: #f9fafb; font-weight: 600; }
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 24px; border-radius: 8px; width: 90%; max-width: 400px; }
        .hidden { display: none !important; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px; }
        @media (min-width: 769px) { .stats-grid { grid-template-columns: repeat(4, 1fr); } }
        .stat-card { background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .stat-number { font-size: 24px; font-weight: bold; color: #2563eb; }
        .stat-label { font-size: 12px; color: #6b7280; margin-top: 4px; }
        .charts-container { display: grid; grid-template-columns: 1fr; gap: 24px; margin-bottom: 24px; }
        @media (min-width: 1024px) { .charts-container { grid-template-columns: 1fr 1fr; } }
        .chart-card { background: white; padding: 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .chart-wrapper { height: 300px; margin: 20px 0; }
        .chart-legend { display: grid; gap: 8px; max-height: 200px; overflow-y: auto; }
        .legend-item { display: flex; justify-content: space-between; padding: 8px 12px; background: #f9fafb; border-radius: 6px; }
        .legend-color { width: 16px; height: 16px; border-radius: 4px; margin-right: 8px; display: inline-block; }
    </style>
</head>
<body>
<script>
// 定義 POS 系統 - 必須在 HTML 之前
window.POS = {
    data: {
        products: [],
        cart: [],
        sales: [],
        editingId: null,
        charts: { quantity: null, revenue: null }
    },
    
    db: {
        async init() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('POSSystemDB', 2);
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
                request.onupgradeneeded = (e) => {
                    const db = e.target.result;
                    if (!db.objectStoreNames.contains('products')) {
                        db.createObjectStore('products', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('sales')) {
                        db.createObjectStore('sales', { keyPath: 'id' });
                    }
                };
            });
        },
        
        async operate(store, operation, data = null) {
            try {
                const db = await this.init();
                const tx = db.transaction([store], operation === 'getAll' ? 'readonly' : 'readwrite');
                const objectStore = tx.objectStore(store);
                let request;
                
                if (operation === 'add') request = objectStore.add(data);
                else if (operation === 'put') request = objectStore.put(data);
                else if (operation === 'delete') request = objectStore.delete(data);
                else if (operation === 'getAll') request = objectStore.getAll();
                
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            } catch (error) {
                console.error('DB錯誤:', error);
                return null;
            }
        }
    },
    
    async loadProducts() {
        const products = await this.db.operate('products', 'getAll');
        this.data.products = products || [];
        this.renderProducts();
    },
    
    async loadSales() {
        const sales = await this.db.operate('sales', 'getAll');
        this.data.sales = sales || [];
    },
    
    renderProducts() {
        const grid = document.getElementById('productGrid');
        if (!grid) return;
        grid.innerHTML = '';
        
        this.data.products.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <div style="font-weight: 500;">${product.name}</div>
                <div style="color: #2563eb; font-weight: bold;">$${product.price}</div>
            `;
            card.onclick = () => this.addToCart(product);
            grid.appendChild(card);
        });
    },
    
    addToCart(product) {
        const existing = this.data.cart.find(item => item.id === product.id);
        if (existing) {
            existing.quantity += 1;
        } else {
            this.data.cart.push({ ...product, quantity: 1 });
        }
        this.updateCart();
    },
    
    updateCart() {
        const container = document.getElementById('cartItems');
        const totalEl = document.getElementById('totalAmount');
        const btn = document.getElementById('checkoutBtn');
        
        if (this.data.cart.length === 0) {
            container.innerHTML = '<div style="text-align:center;color:#6b7280;padding:40px;">🛒<br>購物車是空的</div>';
            btn.disabled = true;
            totalEl.textContent = '總計: $0';
            return;
        }
        
        let total = 0;
        container.innerHTML = '';
        
        this.data.cart.forEach(item => {
            total += item.price * item.quantity;
            const div = document.createElement('div');
            div.className = 'cart-item';
            div.innerHTML = `
                <div style="flex:1;">
                    <div style="font-weight:500;">${item.name}</div>
                    <div style="font-size:12px;color:#6b7280;">$${item.price} × ${item.quantity}</div>
                </div>
                <div style="display:flex;gap:4px;align-items:center;">
                    <button class="control-btn" onclick="POS.updateQuantity('${item.id}', ${item.quantity - 1})">-</button>
                    <span style="width:32px;text-align:center;">${item.quantity}</span>
                    <button class="control-btn" onclick="POS.updateQuantity('${item.id}', ${item.quantity + 1})">+</button>
                    <button class="control-btn" onclick="POS.removeFromCart('${item.id}')" style="background:#fef2f2;color:#dc2626;">×</button>
                </div>
            `;
            container.appendChild(div);
        });
        
        totalEl.textContent = `總計: $${total}`;
        btn.disabled = false;
    },
    
    updateQuantity(id, newQty) {
        if (newQty <= 0) {
            this.removeFromCart(id);
        } else {
            const item = this.data.cart.find(i => i.id === id);
            if (item) {
                item.quantity = newQty;
                this.updateCart();
            }
        }
    },
    
    removeFromCart(id) {
        this.data.cart = this.data.cart.filter(item => item.id !== id);
        this.updateCart();
    },
    
    async checkout() {
        if (this.data.cart.length === 0) return;
        
        const total = this.data.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
        const sale = {
            id: Date.now().toString(),
            items: [...this.data.cart],
            total: total,
            timestamp: new Date().toISOString()
        };
        
        await this.db.operate('sales', 'add', sale);
        this.data.sales.push(sale);
        this.showAlert(`結帳成功！總金額：$${total}`);
        this.data.cart = [];
        this.updateCart();
    },
    
    async addManualProduct() {
        const name = document.getElementById('productName').value.trim();
        const price = parseFloat(document.getElementById('productPrice').value);
        
        if (!name || !price) {
            this.showAlert('請輸入商品名稱和價格');
            return;
        }
        
        // 創建臨時商品（不儲存到資料庫）
        const tempProduct = {
            id: 'temp_' + Date.now().toString(),
            name: name,
            price: price
        };
        
        // 直接加入購物車
        this.addToCart(tempProduct);
        
        // 清空輸入框
        document.getElementById('productName').value = '';
        document.getElementById('productPrice').value = '';
        
        // 不調用 renderProducts()，所以不會顯示在商品網格中
        // 不調用 db.operate()，所以不會儲存到資料庫
    },
    
    showPage(page) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        
        const pageEl = document.getElementById(page + 'Page');
        if (pageEl) pageEl.classList.add('active');
        
        event.target.classList.add('active');
        
        if (page === 'products') this.renderProductsTable();
        if (page === 'reports') {
            this.updateReports();
            setTimeout(() => this.updateCharts(), 100);
        }
    },
    
    renderProductsTable() {
        const tbody = document.getElementById('productsTableBody');
        tbody.innerHTML = '';
        
        if (this.data.products.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;color:#6b7280;padding:40px;">暫無商品</td></tr>';
            return;
        }
        
        this.data.products.forEach(p => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${p.name}</td>
                <td>$${p.price}</td>
                <td>
                    <button class="button" onclick="POS.editProduct('${p.id}')" style="padding:6px 12px;font-size:12px;margin-right:8px;">編輯</button>
                    <button class="button button-red" onclick="POS.deleteProduct('${p.id}')" style="padding:6px 12px;font-size:12px;">刪除</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    },
    
    showProductModal(product = null) {
        this.data.editingId = product ? product.id : null;
        document.getElementById('modalTitle').textContent = product ? '編輯商品' : '新增商品';
        document.getElementById('modalProductName').value = product ? product.name : '';
        document.getElementById('modalProductPrice').value = product ? product.price : '';
        document.getElementById('productModal').classList.remove('hidden');
    },
    
    closeProductModal() {
        document.getElementById('productModal').classList.add('hidden');
        this.data.editingId = null;
    },
    
    async saveProduct() {
        const name = document.getElementById('modalProductName').value.trim();
        const price = parseFloat(document.getElementById('modalProductPrice').value);
        
        if (!name || !price) {
            this.showAlert('請輸入商品名稱和價格');
            return;
        }
        
        const product = {
            id: this.data.editingId || Date.now().toString(),
            name: name,
            price: price
        };
        
        await this.db.operate('products', 'put', product);
        
        if (this.data.editingId) {
            const idx = this.data.products.findIndex(p => p.id === this.data.editingId);
            if (idx !== -1) this.data.products[idx] = product;
        } else {
            this.data.products.push(product);
        }
        
        this.renderProducts();
        this.renderProductsTable();
        this.closeProductModal();
        this.showAlert(this.data.editingId ? '商品更新成功' : '商品新增成功');
    },
    
    editProduct(id) {
        const product = this.data.products.find(p => p.id === id);
        if (product) this.showProductModal(product);
    },
    
    async deleteProduct(id) {
        if (!confirm('確定要刪除此商品嗎？')) return;
        
        await this.db.operate('products', 'delete', id);
        this.data.products = this.data.products.filter(p => p.id !== id);
        this.renderProducts();
        this.renderProductsTable();
        this.showAlert('商品刪除成功');
    },
    
    async clearAllSales() {
        if (!confirm('確定要清除所有銷售記錄嗎？此操作無法復原！')) return;
        
        // 清除資料庫中的所有銷售記錄
        for (const sale of this.data.sales) {
            await this.db.operate('sales', 'delete', sale.id);
        }
        
        this.data.sales = [];
        this.updateReports();
        this.updateCharts();
        this.showAlert('已清除所有銷售記錄');
    },
    
    async clearSingleSale(saleId) {
        if (!confirm('確定要刪除此筆銷售記錄嗎？')) return;
        
        await this.db.operate('sales', 'delete', saleId);
        this.data.sales = this.data.sales.filter(s => s.id !== saleId);
        this.updateReports();
        this.updateCharts();
        this.showAlert('銷售記錄已刪除');
    },
        document.getElementById('totalProducts').textContent = this.data.products.length;
        document.getElementById('totalSales').textContent = this.data.sales.length;
        
        const revenue = this.data.sales.reduce((sum, s) => sum + s.total, 0);
        document.getElementById('totalRevenue').textContent = '$' + revenue.toLocaleString();
        document.getElementById('avgOrder').textContent = this.data.sales.length > 0 ? '$' + Math.round(revenue / this.data.sales.length) : '$0';
        
        const history = document.getElementById('salesHistory');
        if (this.data.sales.length === 0) {
            history.innerHTML = '<p style="text-align:center;color:#6b7280;padding:40px;">暫無銷售記錄</p>';
        } else {
            history.innerHTML = '';
            this.data.sales.slice(-10).reverse().forEach(sale => {
                const div = document.createElement('div');
                div.style.cssText = 'padding:12px;border-bottom:1px solid #f3f4f6;';
                div.innerHTML = `
                    <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
                        <span style="font-size:12px;color:#6b7280;">${new Date(sale.timestamp).toLocaleString('zh-TW')}</span>
                        <span style="font-weight:600;">$${sale.total}</span>
                    </div>
                    <div style="font-size:12px;color:#6b7280;">
                        ${sale.items.map(i => `${i.name}×${i.quantity}`).join(', ')}
                    </div>
                `;
                history.appendChild(div);
            });
        }
    },
    
    updateCharts() {
        if (this.data.charts.quantity) this.data.charts.quantity.destroy();
        if (this.data.charts.revenue) this.data.charts.revenue.destroy();
        
        const stats = {};
        this.data.sales.forEach(sale => {
            sale.items.forEach(item => {
                if (!stats[item.name]) stats[item.name] = { qty: 0, rev: 0 };
                stats[item.name].qty += item.quantity;
                stats[item.name].rev += item.quantity * item.price;
            });
        });
        
        const names = Object.keys(stats);
        if (names.length === 0) {
            document.getElementById('quantityEmpty').classList.remove('hidden');
            document.getElementById('revenueEmpty').classList.remove('hidden');
            document.getElementById('quantityChart').style.display = 'none';
            document.getElementById('revenueChart').style.display = 'none';
            return;
        }
        
        document.getElementById('quantityEmpty').classList.add('hidden');
        document.getElementById('revenueEmpty').classList.add('hidden');
        document.getElementById('quantityChart').style.display = 'block';
        document.getElementById('revenueChart').style.display = 'block';
        
        const colors = ['#FF6B6B','#4ECDC4','#45B7D1','#96CEB4','#FFEAA7','#DDA0DD','#98D8C8','#F7DC6F'];
        const qtyData = names.map((n,i) => ({ name: n, value: stats[n].qty, color: colors[i % colors.length] })).sort((a,b) => b.value - a.value);
        const revData = names.map((n,i) => ({ name: n, value: stats[n].rev, color: colors[i % colors.length] })).sort((a,b) => b.value - a.value);
        
        this.data.charts.quantity = new Chart(document.getElementById('quantityChart'), {
            type: 'pie',
            data: {
                labels: qtyData.map(d => d.name),
                datasets: [{ data: qtyData.map(d => d.value), backgroundColor: qtyData.map(d => d.color), borderWidth: 2 }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } }
            }
        });
        
        this.data.charts.revenue = new Chart(document.getElementById('revenueChart'), {
            type: 'pie',
            data: {
                labels: revData.map(d => d.name),
                datasets: [{ data: revData.map(d => d.value), backgroundColor: revData.map(d => d.color), borderWidth: 2 }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } }
            }
        });
        
        this.renderLegend('quantityLegend', qtyData, false);
        this.renderLegend('revenueLegend', revData, true);
    },
    
    renderLegend(id, data, isMoney) {
        const container = document.getElementById(id);
        const total = data.reduce((sum, d) => sum + d.value, 0);
        container.innerHTML = '';
        
        data.forEach(d => {
            const pct = ((d.value / total) * 100).toFixed(1);
            const div = document.createElement('div');
            div.className = 'legend-item';
            div.innerHTML = `
                <div style="display:flex;align-items:center;">
                    <span class="legend-color" style="background:${d.color};"></span>
                    <span>${d.name}</span>
                </div>
                <div>
                    <span style="font-weight:600;">${isMoney ? '$' + d.value.toLocaleString() : d.value.toLocaleString()}</span>
                    <span style="font-size:12px;color:#6b7280;margin-left:4px;">(${pct}%)</span>
                </div>
            `;
            container.appendChild(div);
        });
    },
    
    exportData() {
        const data = { products: this.data.products, sales: this.data.sales, timestamp: new Date().toISOString() };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'POS備份_' + new Date().toLocaleDateString('zh-TW').replace(/\//g, '-') + '.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        this.showAlert('資料匯出成功！');
    },
    
    importData() {
        const file = document.getElementById('importFile').files[0];
        if (!file) {
            this.showAlert('請選擇檔案');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                const data = JSON.parse(e.target.result);
                if (!confirm('匯入將覆蓋現有資料，確定繼續？')) return;
                
                if (data.products) {
                    for (const p of data.products) {
                        await this.db.operate('products', 'put', p);
                    }
                    this.data.products = data.products;
                    this.renderProducts();
                    this.renderProductsTable();
                }
                
                if (data.sales) {
                    for (const s of data.sales) {
                        await this.db.operate('sales', 'put', s);
                    }
                    this.data.sales = data.sales;
                }
                
                document.getElementById('importFile').value = '';
                this.showAlert('匯入成功！');
            } catch (err) {
                console.error(err);
                this.showAlert('匯入失敗，請檢查檔案格式');
            }
        };
        reader.readAsText(file);
    },
    
    showAlert(msg) {
        document.getElementById('alertMessage').textContent = msg;
        document.getElementById('alertModal').classList.remove('hidden');
    },
    
    closeAlert() {
        document.getElementById('alertModal').classList.add('hidden');
    },
    
    async init() {
        console.log('初始化 POS 系統...');
        await this.loadProducts();
        await this.loadSales();
        console.log('載入完成 - 商品:', this.data.products.length, '銷售:', this.data.sales.length);
    }
};

// 頁面載入後初始化
document.addEventListener('DOMContentLoaded', () => {
    POS.init();
});
</script>

<div class="container">
    <div class="header">
        <div class="nav">
            <h1 class="title">POS銷售系統</h1>
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="POS.showPage('sales')">銷售</button>
                <button class="nav-btn" onclick="POS.showPage('products')">商品</button>
                <button class="nav-btn" onclick="POS.showPage('reports')">報表</button>
                <button class="nav-btn" onclick="POS.showPage('backup')">備份</button>
            </div>
        </div>
    </div>
    
    <div class="main">
        <div id="salesPage" class="page active">
            <div class="sales-layout">
                <div class="products-area">
                    <h2 class="section-title">商品選擇</h2>
                    <div class="card">
                        <h3 style="font-weight:500;margin-bottom:12px;">快速新增商品</h3>
                        <div style="display:flex;gap:8px;">
                            <input id="productName" type="text" class="input" placeholder="商品名稱" style="flex:1;">
                            <input id="productPrice" type="number" class="input" placeholder="價格" step="0.01" style="width:120px;">
                            <button onclick="POS.addManualProduct()" class="button button-green">新增</button>
                        </div>
                    </div>
                    <div id="productGrid" class="product-grid"></div>
                </div>
                <div class="cart-area">
                    <h2 class="section-title">購物車</h2>
                    <div id="cartItems" class="cart-items">
                        <div style="text-align:center;color:#6b7280;padding:40px;">🛒<br>購物車是空的</div>
                    </div>
                    <div style="padding-top:12px;border-top:1px solid #e5e7eb;">
                        <div id="totalAmount" style="font-size:18px;font-weight:bold;margin-bottom:12px;">總計: $0</div>
                        <button onclick="POS.checkout()" class="button" style="width:100%;" disabled id="checkoutBtn">結帳</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="productsPage" class="page">
            <div class="page-content">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
                    <h2 class="section-title" style="margin:0;">商品管理</h2>
                    <button class="button button-green" onclick="POS.showProductModal()">新增商品</button>
                </div>
                <div class="card">
                    <table class="table"><thead><tr><th>商品名稱</th><th>價格</th><th>操作</th></tr></thead><tbody id="productsTableBody"></tbody></table>
                </div>
            </div>
        </div>
        
        <div id="reportsPage" class="page">
            <div class="page-content">
                <h2 class="section-title">銷售報表</h2>
                <div class="stats-grid">
                    <div class="stat-card"><div id="totalProducts" class="stat-number">0</div><div class="stat-label">商品總數</div></div>
                    <div class="stat-card"><div id="totalSales" class="stat-number">0</div><div class="stat-label">銷售筆數</div></div>
                    <div class="stat-card"><div id="totalRevenue" class="stat-number">$0</div><div class="stat-label">總營收</div></div>
                    <div class="stat-card"><div id="avgOrder" class="stat-number">$0</div><div class="stat-label">平均客單價</div></div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div style="font-size:18px;font-weight:700;margin-bottom:4px;">📊 商品銷售數量分析</div>
                        <div style="font-size:14px;color:#6b7280;margin-bottom:20px;">依銷售數量統計各商品占比</div>
                        <div class="chart-wrapper">
                            <canvas id="quantityChart"></canvas>
                            <div id="quantityEmpty" class="hidden" style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:#9ca3af;">
                                <div style="font-size:48px;margin-bottom:12px;">📈</div>
                                <div style="font-size:16px;font-weight:500;">暫無銷售數據</div>
                            </div>
                        </div>
                        <div id="quantityLegend" class="chart-legend"></div>
                    </div>
                    
                    <div class="chart-card">
                        <div style="font-size:18px;font-weight:700;margin-bottom:4px;">💰 商品銷售金額分析</div>
                        <div style="font-size:14px;color:#6b7280;margin-bottom:20px;">依銷售金額統計各商品占比</div>
                        <div class="chart-wrapper">
                            <canvas id="revenueChart"></canvas>
                            <div id="revenueEmpty" class="hidden" style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:#9ca3af;">
                                <div style="font-size:48px;margin-bottom:12px;">💸</div>
                                <div style="font-size:16px;font-weight:500;">暫無營收數據</div>
                            </div>
                        </div>
                        <div id="revenueLegend" class="chart-legend"></div>
                    </div>
                </div>
                
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                        <h3 style="font-weight:600;margin:0;">銷售記錄</h3>
                        <button class="button button-red" onclick="POS.clearAllSales()" style="padding:8px 16px;font-size:14px;">清除全部記錄</button>
                    </div>
                    <div id="salesHistory" style="max-height:300px;overflow-y:auto;">
                        <p style="text-align:center;color:#6b7280;padding:40px;">暫無銷售記錄</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="backupPage" class="page">
            <div class="page-content">
                <h2 class="section-title">資料備份與還原</h2>
                <div style="display:grid;gap:16px;">
                    <div class="card">
                        <h3 style="font-weight:600;margin-bottom:12px;">備份資料</h3>
                        <p style="color:#6b7280;margin-bottom:16px;">將所有商品和銷售資料匯出為檔案</p>
                        <button class="button" onclick="POS.exportData()">匯出資料</button>
                    </div>
                    <div class="card">
                        <h3 style="font-weight:600;margin-bottom:12px;">還原資料</h3>
                        <p style="color:#6b7280;margin-bottom:16px;">從備份檔案還原資料</p>
                        <input type="file" id="importFile" accept=".json" style="margin-bottom:12px;">
                        <button class="button button-gray" onclick="POS.importData()">匯入資料</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="productModal" class="modal hidden">
    <div class="modal-content">
        <h3 id="modalTitle" style="font-size:18px;font-weight:600;margin-bottom:16px;">新增商品</h3>
        <div style="margin-bottom:16px;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">商品名稱</label>
            <input id="modalProductName" type="text" class="input">
        </div>
        <div style="margin-bottom:20px;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">價格</label>
            <input id="modalProductPrice" type="number" class="input" step="0.01">
        </div>
        <div style="display:flex;gap:8px;">
            <button class="button" onclick="POS.saveProduct()">儲存</button>
            <button class="button button-gray" onclick="POS.closeProductModal()">取消</button>
        </div>
    </div>
</div>

<div id="alertModal" class="modal hidden">
    <div class="modal-content">
        <h3 style="font-size:18px;font-weight:600;margin-bottom:8px;">提示訊息</h3>
        <p id="alertMessage" style="color:#6b7280;margin-bottom:16px;"></p>
        <button class="button" onclick="POS.closeAlert()">確定</button>
    </div>
</div>

</body>
</html>
